{% extends 'base.html' %}

{% block content %}
<div class="message-box">
    <h2>Chat Room: {{ room }}</h2>

    <!-- Chat Messages -->
    <div id="messages" style="border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px;">
        {% for message in messages %}
        <div class="message">
            <strong>{{ message.name }}</strong>: {{ message.message }}
        </div>
        {% endfor %}
    </div>

    <!-- Message Input Box -->
    <div style="margin-top: 10px;">
        <input type="text" id="message" placeholder="Type your message..." style="width: 80%;" />
        <button type="button" id="send-btn" style="width: 18%;" onclick="sendMessage()">Send</button>
    </div>
</div>

<!-- SocketIO script -->
<script type="text/javascript">
    var socket = io();

    var room = "{{ room }}";
    var name = "{{ name }}";

    // Automatically join the room upon loading the page
    socket.emit('join', {room: room, name: name});

    // Listen for incoming messages from the server
    socket.on("message", function(data) {
        const messagesDiv = document.getElementById("messages");
        const newMessage = document.createElement("div");
        newMessage.classList.add("message");
        newMessage.innerHTML = `<strong>${data.name}</strong>: ${data.message}`;
        messagesDiv.appendChild(newMessage);

        // Auto scroll to the bottom
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    // Function to send a message
    function sendMessage() {
        const messageInput = document.getElementById("message");
        if (messageInput.value.trim() !== "") {
            socket.emit('message', {data: messageInput.value});
            messageInput.value = ""; // Clear the input after sending
        }
    }
</script>
{% endblock %}
